24区可視化　作業方針
・macでの作業。文字コードutf-8前提。Windowsは未検証。
・Rで大阪市オープンデータポータルにある24区のシェープファイルに、csvを組み合わせて可視化する
・シェープファイルのATTR2が区名なので、それをキーに、.shpファイルと.csvファイルを結合させる
・そのため、事前にcsvファイルは区名の項目名をATTR2にしておくこと。

#ライブラリ読込
library(dplyr)
library(sf)
library(readr)
library(RColorBrewer)

#24区シェープファイル読込
shape <- st_read("24区画像.shp")

#csvファイル読込
population <- read_csv("H29-10-suikei.csv")

#シェープファイルとcsvファイルを区名のATTR2をキーとして結合
data <- inner_join(shape, population, by="ATTR2")

#macではplotで文字化けするので防止
par(family = "HiraKakuProN-W3")

#可視化
plot(data)

#シェープファイル固有の前から5つは可視化しない
plot(data %>% select(-(1:5)))

#k-means法で離散化してカラーパレット作成
col_km <- data$総数 %>% classIntervals(.,n=8,style=“means”) %>% findColours(.,pal=brewer.pal(8,”Reds”))

#項目を選択して可視化
plot(data %>% select(総数), col=col_km)

#項目はカラムの数値で指示可能
plot(data %>% select(6))

#凡例
library(stringr)
legend(“topleft”, legend=str_sub(gsub(“,”, “~”, names(attr(col_km, “table”))), start=2, end=-2), fill=attr(col_km, “palette”))